"""
带工具的 Agent - 金融 Agent
=================================
你的第一个 Agno Agent：一个数据驱动的金融分析师，可获取
市场数据、计算关键指标并提供简洁的洞察。

本示例展示如何为 Agent 提供工具以与外部数据源交互。
Agent 使用 YFinanceTools 获取实时市场数据。

可尝试的示例提示：
- "AAPL 的当前价格是多少？"
- "对比 NVDA 和 AMD — 哪个更强？"
- "给我一份关于微软的快速投资简报"
- "特斯拉的市盈率是多少，与行业相比如何？"
- "展示 FAANG 股票的关键指标"
"""

import os

from dotenv import load_dotenv

from agno.agent import Agent
from agno.models.openai import OpenAILike
from agno.tools.yfinance import YFinanceTools

load_dotenv()

# ---------------------------------------------------------------------------
# Agent 指令
# ---------------------------------------------------------------------------
instructions = """\
你是一个金融 Agent——一个数据驱动的分析师，负责获取市场数据、
计算关键指标，并提供简洁的、可供决策的洞察。

## 工作流程

1. 澄清
   - 从公司名称识别股票代码（例如 Apple → AAPL）
   - 如有歧义，请询问

2. 获取数据
   - 获取：价格、涨跌幅、市值、市盈率、每股收益、52周范围
   - 对比分析时，为每只股票获取相同字段

3. 分析
   - 在未提供时计算比率（市盈率、市销率、利润率）
   - 关键驱动因素和风险——最多 2-3 条
   - 仅陈述事实，不做投机

4. 呈现
   - 以一行摘要开头
   - 多股对比使用表格
   - 保持精炼

## 规则

- 数据来源：Yahoo Finance。始终标注时间戳。
- 数据缺失？标注"N/A"，继续。
- 不提供个性化建议——相关时添加免责声明。
- 不使用 emoji。\
"""

# ---------------------------------------------------------------------------
# 创建 Agent
# ---------------------------------------------------------------------------
agent_with_tools = Agent(
    name="Agent with Tools",
    model=OpenAILike(
        id=os.getenv("MODEL_ID", "GLM-4.7"),
        base_url=os.getenv("MODEL_BASE_URL", "https://open.bigmodel.cn/api/coding/paas/v4/"),
        api_key=os.getenv("MODEL_API_KEY"),
    ),
    instructions=instructions,
    tools=[YFinanceTools()],
    add_datetime_to_context=True,
    markdown=True,
    debug_mode=True,
)

# ---------------------------------------------------------------------------
# 运行 Agent
# ---------------------------------------------------------------------------
if __name__ == "__main__":
    agent_with_tools.print_response(
        "给我一份关于英伟达的快速投资简报", stream=True
    )

# ---------------------------------------------------------------------------
# 更多示例
# ---------------------------------------------------------------------------
"""
可尝试以下提示：

1. 单只股票分析
   "苹果的当前估值是多少？贵吗？"

2. 股票对比
   "比较谷歌和微软的投资价值"

3. 板块概览
   "展示顶级 AI 股票的关键指标：NVDA、AMD、GOOGL、MSFT"

4. 快速查询
   "特斯拉今天的交易价格是多少？"

5. 深度分析
   "分解亚马逊的财务状况 — 收入、利润率和增长"
"""
